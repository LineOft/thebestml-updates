<style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; color: #fff; overflow-x: hidden; }
    .container { max-width: 500px; margin: 0 auto; padding: 20px; padding-top: 50px; padding-bottom: 100px; }
    .header { text-align: center; margin-bottom: 30px; }
    .logo { font-size: 60px; margin-bottom: 15px; }
    .title { font-size: 26px; font-weight: bold; margin-bottom: 8px; }
    .subtitle { color: #aaa; font-size: 14px; }
    .version { color: #666; font-size: 12px; margin-top: 5px; }
    .btn { display: block; width: 100%; padding: 18px 20px; border: none; border-radius: 15px; font-size: 16px; font-weight: bold; cursor: pointer; margin-bottom: 15px; transition: all 0.3s ease; text-align: center; }
    .btn:active { transform: scale(0.98); opacity: 0.9; }
    .btn-primary { background: linear-gradient(135deg, #4CAF50, #45a049); color: #fff; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4); }
    .btn-secondary { background: linear-gradient(135deg, #2196F3, #1976D2); color: #fff; box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4); }
    .btn-warning { background: linear-gradient(135deg, #FF9800, #F57C00); color: #fff; }
    .btn-subtext { display: block; font-size: 12px; font-weight: normal; opacity: 0.8; margin-top: 5px; }
    .section { margin-bottom: 25px; }
    .section-title { font-size: 18px; font-weight: bold; margin-bottom: 15px; }
    .step-card { background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; cursor: pointer; transition: all 0.3s ease; }
    .step-card:active { background: rgba(76, 175, 80, 0.2); }
    .step-card.completed { border-color: #4CAF50; background: rgba(76, 175, 80, 0.15); }
    .step-number { width: 35px; height: 35px; border-radius: 50%; background: #0f3460; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px; }
    .step-card.completed .step-number { background: #4CAF50; }
    .step-content { flex: 1; }
    .step-title { font-weight: bold; margin-bottom: 3px; }
    .step-desc { color: #aaa; font-size: 12px; }
    .key-box { background: linear-gradient(135deg, #0f3460, #16213e); border: 2px solid #4CAF50; border-radius: 15px; padding: 20px; text-align: center; margin: 20px 0; }
    .key-label { color: #aaa; font-size: 14px; margin-bottom: 10px; }
    .key-value { font-size: 32px; font-weight: bold; color: #4CAF50; letter-spacing: 4px; font-family: monospace; }
    .key-copy { background: #4CAF50; color: #fff; border: none; padding: 12px 25px; border-radius: 10px; margin-top: 15px; cursor: pointer; font-weight: bold; font-size: 14px; }
    .features { background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; }
    .feature-item { color: #aaa; font-size: 14px; margin-bottom: 10px; }
    .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(100px); background: #333; color: #fff; padding: 15px 30px; border-radius: 10px; z-index: 1002; transition: transform 0.3s ease; font-size: 14px; }
    .toast.show { transform: translateX(-50%) translateY(0); }
    .update-badge { display: none; background: #f44336; color: #fff; padding: 3px 8px; border-radius: 10px; font-size: 10px; margin-left: 10px; animation: pulse 2s infinite; }
    .update-badge.show { display: inline-block; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
</style>

<div class="container">
    <div class="header">
        <div class="logo">ðŸŽ®</div>
        <h1 class="title">TheBestML IMGUI V2.8</h1>
        <p class="subtitle">Otomatik Kurulum UygulamasÄ±</p>
        <p class="version">SÃ¼rÃ¼m: <span id="currentVersion">1.6.2</span></p>
    </div>

    <div class="section">
        <button class="btn btn-primary" onclick="oneTapInstall()">
            âš¡ TEK DOKUNUÅžTA KURULUM
            <span class="btn-subtext">TÃ¼m adÄ±mlarÄ± otomatik yapar</span>
        </button>
        
        <button class="btn" style="background: linear-gradient(135deg, #e91e63, #c2185b);" onclick="autoCertDisable()">
            ðŸ¤– OTOMATÄ°K SERTÄ°FÄ°KA KAPAT
            <span class="btn-subtext">GlobalSign hariÃ§ tÃ¼mÃ¼nÃ¼ kapat</span>
        </button>
        
        <button class="btn btn-secondary" onclick="downloadAPK()">
            ðŸ“¥ IMGUI APK Ä°NDÄ°R
            <span class="btn-subtext">TheBestML IMGUI V2.8</span>
        </button>
    </div>

    <div class="key-box">
        <div class="key-label">ðŸ”‘ GiriÅŸ Key'i</div>
        <div class="key-value" id="keyDisplay">THEBEST2024</div>
        <button class="key-copy" onclick="copyKey()">ðŸ“‹ KOPYALA</button>
    </div>

    <div class="section">
        <div class="section-title">ðŸ“Œ AdÄ±m AdÄ±m Kurulum</div>
        
        <div class="step-card" id="step1" onclick="openPlayStore()">
            <div class="step-number">1</div>
            <div class="step-content">
                <div class="step-title">Mobile Legends Ä°ndir</div>
                <div class="step-desc">Play Store'dan orijinal ML</div>
            </div>
        </div>
        
        <div class="step-card" id="step2" onclick="autoCertDisable()">
            <div class="step-number">2</div>
            <div class="step-content">
                <div class="step-title">ðŸ¤– SertifikalarÄ± Otomatik Kapat</div>
                <div class="step-desc">GlobalSign NV-SA hariÃ§ tÃ¼mÃ¼</div>
            </div>
        </div>
        
        <div class="step-card" id="step3" onclick="downloadAPK()">
            <div class="step-number">3</div>
            <div class="step-content">
                <div class="step-title">APK Ä°ndir ve Kur</div>
                <div class="step-desc">TheBestML IMGUI APK</div>
            </div>
        </div>
        
        <div class="step-card" id="step4" onclick="showKeyAlert()">
            <div class="step-number">4</div>
            <div class="step-content">
                <div class="step-title">Key ile GiriÅŸ</div>
                <div class="step-desc">ðŸ”‘ THEBEST2024</div>
            </div>
        </div>
    </div>

    <div class="section">
        <button class="btn btn-warning" onclick="openSecurityManual()">
            ðŸ”’ Manuel Sertifika AyarlarÄ±
        </button>
        
        <button class="btn" style="background: linear-gradient(135deg, #9C27B0, #7B1FA2);" onclick="checkForUpdates()">
            ðŸ”„ GÃœNCELLEME KONTROL
            <span class="btn-subtext" id="updateStatus">Son kontrol: HenÃ¼z kontrol edilmedi</span>
        </button>
    </div>

    <div class="features">
        <div class="section-title">âœ¨ Ã–zellikler</div>
        <div class="feature-item">âœ… Orman YaratÄ±klarÄ±nÄ± GÃ¶rme</div>
        <div class="feature-item">âœ… Otomatik Kurulum</div>
        <div class="feature-item">âœ… Root & Rootsuz Destek</div>
        <div class="feature-item">âœ… TÃ¼m Android Telefonlarda Ã‡alÄ±ÅŸÄ±r</div>
        <div class="feature-item">âœ… OTA GÃ¼ncelleme (Otomatik)</div>
        <div class="feature-item">ðŸ¤– Otomatik Sertifika Kapatma</div>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
    // Capacitor Plugin referansÄ±
    let CertManager = null;
    let capacitorReady = false;
    
    // Config'i localStorage'dan al
    let appConfig = {
        version: '1.6.7',
        key: 'THEBEST2024',
        apkUrl: 'https://dosya.co/dho18v1fbzq0/THEBEST_IMGUI-v2.8.apk.html',
        playStoreUrl: 'https://play.google.com/store/apps/details?id=com.mobile.legends'
    };
    
    // Mevcut uygulama versiyonu (hardcoded)
    const APP_VERSION = '1.6.7';
    
    // Capacitor Plugin'i yÃ¼kle
    async function initCapacitor() {
        // Capacitor yÃ¼klenene kadar bekle
        let retries = 0;
        while (retries < 10) {
            if (window.Capacitor && window.Capacitor.Plugins && window.Capacitor.Plugins.CertificateManager) {
                CertManager = window.Capacitor.Plugins.CertificateManager;
                capacitorReady = true;
                console.log('âœ… Capacitor CertificateManager yÃ¼klendi');
                return true;
            }
            await new Promise(r => setTimeout(r, 200));
            retries++;
        }
        console.log('âš ï¸ CertificateManager bulunamadÄ±, fallback kullanÄ±lacak');
        return false;
    }
    
    // Android Intent ile ayarlarÄ± aÃ§ (fallback)
    function openAndroidSettings(settingsType) {
        let intentUrl = '';
        switch(settingsType) {
            case 'accessibility':
                intentUrl = 'intent://settings/accessibility#Intent;scheme=android-app;package=com.android.settings;end';
                break;
            case 'security':
                intentUrl = 'intent://settings/security#Intent;scheme=android-app;package=com.android.settings;end';
                break;
            default:
                intentUrl = 'intent://settings#Intent;scheme=android-app;package=com.android.settings;end';
        }
        
        // Ã–nce intent URL'yi dene
        const link = document.createElement('a');
        link.href = intentUrl;
        link.click();
    }
    
    // Sayfa yÃ¼klendiÄŸinde
    document.addEventListener('DOMContentLoaded', async function() {
        // Capacitor plugin'i yÃ¼kle
        await initCapacitor();
        
        // localStorage'dan config yÃ¼kle
        try {
            const savedConfig = localStorage.getItem('thebestml_config');
            if (savedConfig) {
                const parsed = JSON.parse(savedConfig);
                appConfig = { ...appConfig, ...parsed };
            }
        } catch (e) {}
        
        // Mevcut versiyonu kaydet ve gÃ¶ster
        localStorage.setItem('thebestml_app_version', APP_VERSION);
        document.getElementById('currentVersion').textContent = APP_VERSION;
        if (appConfig.key) document.getElementById('keyDisplay').textContent = appConfig.key;
    });

    // Otomatik Sertifika Kapatma
    async function autoCertDisable() {
        // Capacitor hazÄ±r deÄŸilse tekrar dene
        if (!CertManager) {
            await initCapacitor();
        }
        
        if (!CertManager) {
            // Fallback: KullanÄ±cÄ±ya yol gÃ¶ster ve ayarlarÄ± aÃ§
            const choice = confirm(
                'ðŸ” EriÅŸilebilirlik Ä°zni Gerekli\n\n' +
                'SertifikalarÄ± otomatik kapatmak iÃ§in izin vermeniz gerekiyor.\n\n' +
                'âš ï¸ "KÄ±sÄ±tlÄ± ayar" hatasÄ± alÄ±rsanÄ±z:\n' +
                '1ï¸âƒ£ Bu uygulamaya UZUN BASIN\n' +
                '2ï¸âƒ£ "Uygulama bilgisi" seÃ§in\n' +
                '3ï¸âƒ£ SaÄŸ Ã¼st kÃ¶ÅŸedeki â‹® menÃ¼ye tÄ±klayÄ±n\n' +
                '4ï¸âƒ£ "KÄ±sÄ±tlÄ± ayarlara izin ver" AÃ‡IN\n\n' +
                'ðŸ“ Sonra eriÅŸilebilirlik ayarlarÄ±ndan servisi aÃ§Ä±n.\n\n' +
                'AyarlarÄ± aÃ§mak iÃ§in Tamam\'a basÄ±n.'
            );
            
            if (choice) {
                // Android eriÅŸilebilirlik ayarlarÄ±nÄ± aÃ§
                window.location.href = 'intent:#Intent;action=android.settings.ACCESSIBILITY_SETTINGS;end';
                showToast('ðŸ” EriÅŸilebilirlik ayarlarÄ± aÃ§Ä±lÄ±yor...');
            }
            return;
        }
        
        try {
            // Ä°zin kontrolÃ¼
            const result = await CertManager.checkAccessibilityPermission();
            
            if (!result.enabled) {
                const choice = confirm(
                    'ðŸ” EriÅŸilebilirlik Ä°zni Gerekli\n\n' +
                    'âš ï¸ "KÄ±sÄ±tlÄ± ayar" veya "EriÅŸim reddedildi" hatasÄ± alÄ±rsanÄ±z:\n\n' +
                    '1ï¸âƒ£ Bu uygulamaya UZUN BASIN\n' +
                    '2ï¸âƒ£ "Uygulama bilgisi (â“˜)" seÃ§in\n' +
                    '3ï¸âƒ£ SaÄŸ Ã¼st kÃ¶ÅŸedeki â‹® menÃ¼ye tÄ±klayÄ±n\n' +
                    '4ï¸âƒ£ "KÄ±sÄ±tlÄ± ayarlara izin ver" seÃ§eneÄŸini AÃ‡IN\n' +
                    '5ï¸âƒ£ Sonra eriÅŸilebilirlik ayarlarÄ±ndan servisi aÃ§Ä±n\n\n' +
                    'AyarlarÄ± aÃ§mak iÃ§in Tamam\'a basÄ±n.'
                );
                
                if (choice) {
                    // Otomatik modu baÅŸlat ve eriÅŸilebilirlik ayarlarÄ±nÄ± aÃ§
                    await CertManager.openAccessibilitySettingsAndStartAuto();
                    showToast('ðŸ” Servisi bulun ve aÃ§Ä±n!');
                }
                return;
            }
            
            // Ä°zin var, otomatik kapatmayÄ± baÅŸlat
            const startChoice = confirm(
                'ðŸ¤– Otomatik Sertifika Kapatma\n\n' +
                'âš ï¸ Bu iÅŸlem TÃœM sistem sertifikalarÄ±nÄ± kapatacak!\n' +
                'âœ… Sadece GlobalSign NV-SA aÃ§Ä±k kalacak.\n\n' +
                'ðŸ“ Åžimdi gÃ¼venilir kimlik bilgileri aÃ§Ä±lacak:\n' +
                '1ï¸âƒ£ "SÄ°STEM" sekmesine tÄ±klayÄ±n\n' +
                '2ï¸âƒ£ Uygulama otomatik Ã§alÄ±ÅŸacak\n' +
                '3ï¸âƒ£ Ä°ÅŸlem bitene kadar bekleyin\n\n' +
                'BaÅŸlatmak iÃ§in Tamam\'a basÄ±n.'
            );
            
            if (startChoice) {
                await CertManager.startAutoDisable();
                completeStep(2);
                showToast('ðŸ¤– Otomatik kapatma baÅŸladÄ±!');
            }
            
        } catch (error) {
            console.error('Hata:', error);
            alert('âŒ Hata: ' + error.message);
        }
    }

    // Manuel gÃ¼venlik ayarlarÄ±
    async function openSecurityManual() {
        const choice = confirm('ðŸ”’ Manuel Sertifika Kapatma\n\n' +
            '1ï¸âƒ£ Ayarlar > GÃ¼venlik\n' +
            '2ï¸âƒ£ "DiÄŸer gÃ¼venlik ayarlarÄ±" veya\n' +
            '     "Åžifreleme ve kimlik bilgileri"\n' +
            '3ï¸âƒ£ "GÃ¼venilen kimlik bilgileri"\n' +
            '4ï¸âƒ£ "SÄ°STEM" sekmesi\n' +
            '5ï¸âƒ£ Her sertifikaya tÄ±klayÄ±p "Devre dÄ±ÅŸÄ± bÄ±rak"\n\n' +
            'âš ï¸ GlobalSign NV-SA AÃ‡IK kalmalÄ±!\n\n' +
            'GÃ¼venlik ayarlarÄ±nÄ± aÃ§mak iÃ§in Tamam\'a basÄ±n.');
        
        if (choice) {
            if (CertManager) {
                try {
                    await CertManager.openSecuritySettings();
                    return;
                } catch (e) {
                    console.log('CertManager hatasÄ±:', e);
                }
            }
            // Fallback: Intent ile gÃ¼venlik ayarlarÄ±nÄ± aÃ§
            window.location.href = 'intent:#Intent;action=android.settings.SECURITY_SETTINGS;end';
            showToast('ðŸ”’ GÃ¼venlik ayarlarÄ± aÃ§Ä±lÄ±yor...');
        }
    }

    function oneTapInstall() {
        alert('ðŸš€ Kurulum BaÅŸlÄ±yor!\n\n' +
            '1ï¸âƒ£ Mobile Legends indir\n' +
            '2ï¸âƒ£ SertifikalarÄ± otomatik kapat\n' +
            '3ï¸âƒ£ IMGUI APK indir ve kur\n' +
            '4ï¸âƒ£ Key ile giriÅŸ\n\n' +
            'Åžimdi Play Store aÃ§Ä±lacak.');
        openPlayStore();
    }

    function openPlayStore() {
        completeStep(1);
        window.open(appConfig.playStoreUrl, '_system');
        showToast('ðŸ“± Play Store aÃ§Ä±ldÄ±');
    }

    function downloadAPK() {
        completeStep(3);
        window.open(appConfig.apkUrl, '_system');
        showToast('ðŸ“¥ Ä°ndirme baÅŸladÄ±');
    }

    function showKeyAlert() {
        completeStep(4);
        alert('ðŸ”‘ GiriÅŸ Key\'i\n\n' +
            'Klonlanan ML\'yi aÃ§Ä±n ve bu key ile giriÅŸ yapÄ±n:\n\n' +
            'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n' +
            '   ðŸ”‘ ' + appConfig.key + '\n' +
            'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    }

    function copyKey() {
        const key = appConfig.key;
        if (navigator.clipboard) {
            navigator.clipboard.writeText(key).then(() => showToast('âœ… Key kopyalandÄ±: ' + key));
        } else {
            const input = document.createElement('input');
            input.value = key;
            document.body.appendChild(input);
            input.select();
            document.execCommand('copy');
            document.body.removeChild(input);
            showToast('âœ… Key kopyalandÄ±: ' + key);
        }
    }

    function completeStep(stepNum) {
        const step = document.getElementById('step' + stepNum);
        if (step) step.classList.add('completed');
    }

    function showToast(message) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // GÃ¼ncelleme kontrol fonksiyonu
    async function checkForUpdates() {
        const statusEl = document.getElementById('updateStatus');
        const currentVersion = APP_VERSION;
        
        statusEl.textContent = 'â³ Kontrol ediliyor...';
        showToast('ðŸ”„ GÃ¼ncelleme kontrol ediliyor...');
        
        try {
            const manifestUrl = 'https://raw.githubusercontent.com/LineOft/thebestml-updates/main/manifest.json';
            const response = await fetch(manifestUrl + '?t=' + Date.now(), { cache: 'no-store' });
            
            if (!response.ok) {
                throw new Error('Sunucuya baÄŸlanÄ±lamadÄ±');
            }
            
            const manifest = await response.json();
            const latestVersion = manifest.version;
            
            console.log('Current:', currentVersion, 'Latest:', latestVersion);
            
            // SÃ¼rÃ¼m karÅŸÄ±laÅŸtÄ±rma
            if (compareVersions(latestVersion, currentVersion) > 0) {
                // Yeni sÃ¼rÃ¼m var
                statusEl.textContent = 'ðŸ†• Yeni sÃ¼rÃ¼m: v' + latestVersion;
                
                const updateChoice = confirm(
                    'ðŸŽ‰ Yeni GÃ¼ncelleme Mevcut!\n\n' +
                    'ðŸ“± Mevcut sÃ¼rÃ¼m: v' + currentVersion + '\n' +
                    'ðŸ†• Yeni sÃ¼rÃ¼m: v' + latestVersion + '\n\n' +
                    'ðŸ“‹ DeÄŸiÅŸiklikler:\n' + 
                    (manifest.changelog || []).map(c => 'â€¢ ' + c).join('\n') + '\n\n' +
                    'Åžimdi gÃ¼ncellemek ister misiniz?'
                );
                
                if (updateChoice) {
                    applyUpdate();
                }
            } else {
                // GÃ¼ncel
                statusEl.textContent = 'âœ… GÃ¼ncel (v' + currentVersion + ')';
                showToast('âœ… Uygulama gÃ¼ncel! v' + currentVersion);
            }
            
        } catch (error) {
            console.error('GÃ¼ncelleme kontrolÃ¼ hatasÄ±:', error);
            statusEl.textContent = 'âŒ Kontrol baÅŸarÄ±sÄ±z';
            showToast('âŒ GÃ¼ncelleme kontrolÃ¼ baÅŸarÄ±sÄ±z');
        }
    }

    // SÃ¼rÃ¼m karÅŸÄ±laÅŸtÄ±rma (1.6.1 > 1.6.0)
    function compareVersions(v1, v2) {
        const parts1 = v1.split('.').map(Number);
        const parts2 = v2.split('.').map(Number);
        
        for (let i = 0; i < Math.max(parts1.length, parts2.length); i++) {
            const p1 = parts1[i] || 0;
            const p2 = parts2[i] || 0;
            if (p1 > p2) return 1;
            if (p1 < p2) return -1;
        }
        return 0;
    }

    // GÃ¼ncellemeyi uygula
    function applyUpdate() {
        showToast('ðŸ”„ GÃ¼ncelleme uygulanÄ±yor...');
        
        // TÃœM cache'leri temizle - doÄŸru key isimleri
        localStorage.removeItem('thebestml_app_html');
        localStorage.removeItem('thebestml_app_version');
        localStorage.removeItem('thebestml_config');
        localStorage.removeItem('thebestml_app_cache');
        localStorage.removeItem('thebestml_config_cache');
        
        // Service Worker cache'lerini temizle
        if ('caches' in window) {
            caches.keys().then(names => {
                names.forEach(name => caches.delete(name));
            });
        }
        
        // SayfayÄ± yeniden yÃ¼kle (OTA loader yeni sÃ¼rÃ¼mÃ¼ Ã§ekecek)
        setTimeout(() => {
            window.location.reload(true);
        }, 500);
    }
</script>
